# Improved VAE training configuration
from tensorflow.keras.callbacks import EarlyStopping, ReduceLROnPlateau

# Add callbacks for better training
callbacks = [
    EarlyStopping(patience=10, restore_best_weights=True),
    ReduceLROnPlateau(patience=5, factor=0.5, min_lr=1e-6)
]

# Train with callbacks and more epochs
history = vae_model.train(train_data, epochs=150, callbacks=callbacks, verbose=1)
