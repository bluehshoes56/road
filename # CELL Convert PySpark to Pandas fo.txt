# CELL 10: Cross-Tabulation Analysis - Industry & GICS Level

# Create copies to avoid modifying original data
orig_data = original_data.copy()
synth_data = synthetic_data.copy()

# Fix numeric conversion
orig_data['ed_amount'] = pd.to_numeric(orig_data['ed_amount'], errors='coerce')
orig_data['ed_amount'] = orig_data['ed_amount'].fillna(0)

synth_data['ed_amount'] = pd.to_numeric(synth_data['ed_amount'], errors='coerce')
synth_data['ed_amount'] = synth_data['ed_amount'].fillna(0)

print("üè≠ CROSS-TABULATION ANALYSIS")
print("=" * 50)

# =============================================
# INDUSTRY LEVEL CROSS-TABULATION ANALYSIS
# =============================================
print("\nüè≠ INDUSTRY LEVEL CROSS-TABULATION ANALYSIS")
print("=" * 50)

# 1. ORIGINAL DATA - Industry Cross-tabulation
print("\nüè≠ ORIGINAL DATA - PAYER vs PAYEE INDUSTRY:")

# Count cross-tabulation
orig_industry_count_crosstab = pd.crosstab(
    orig_data['payer_industry'],
    orig_data['payee_industry'],
    margins=True,
    margins_name='Total'
)
print("\nüìä TRANSACTION COUNT CROSS-TABULATION (Original):")
display(orig_industry_count_crosstab)

# Amount cross-tabulation
orig_industry_amount_crosstab = pd.crosstab(
    orig_data['payer_industry'],
    orig_data['payee_industry'],
    values=orig_data['ed_amount'],
    aggfunc='sum',
    margins=True,
    margins_name='Total'
).round(0)
print("\nüí∞ TOTAL AMOUNT CROSS-TABULATION (Original):")
display(orig_industry_amount_crosstab)

# Average amount per transaction cross-tabulation
orig_industry_avg_crosstab = pd.crosstab(
    orig_data['payer_industry'],
    orig_data['payee_industry'],
    values=orig_data['ed_amount'],
    aggfunc='mean',
    margins=True,
    margins_name='Total'
).round(0)
print("\nüìä AVERAGE AMOUNT PER TRANSACTION CROSS-TABULATION (Original):")
display(orig_industry_avg_crosstab)

# 2. SYNTHETIC DATA - Industry Cross-tabulation
print("\nü§ñ SYNTHETIC DATA - PAYER vs PAYEE INDUSTRY:")

# Count cross-tabulation
synth_industry_count_crosstab = pd.crosstab(
    synth_data['payer_industry'],
    synth_data['payee_industry'],
    margins=True,
    margins_name='Total'
)
print("\nüìä TRANSACTION COUNT CROSS-TABULATION (Synthetic):")
display(synth_industry_count_crosstab)

# Amount cross-tabulation
synth_industry_amount_crosstab = pd.crosstab(
    synth_data['payer_industry'],
    synth_data['payee_industry'],
    values=synth_data['ed_amount'],
    aggfunc='sum',
    margins=True,
    margins_name='Total'
).round(0)
print("\nüí∞ TOTAL AMOUNT CROSS-TABULATION (Synthetic):")
display(synth_industry_amount_crosstab)

# Average amount per transaction cross-tabulation
synth_industry_avg_crosstab = pd.crosstab(
    synth_data['payer_industry'],
    synth_data['payee_industry'],
    values=synth_data['ed_amount'],
    aggfunc='mean',
    margins=True,
    margins_name='Total'
).round(0)
print("\nüìä AVERAGE AMOUNT PER TRANSACTION CROSS-TABULATION (Synthetic):")
display(synth_industry_avg_crosstab)

# =============================================
# GICS LEVEL CROSS-TABULATION ANALYSIS  
# =============================================
print("\nüìä GICS LEVEL CROSS-TABULATION ANALYSIS")
print("=" * 50)

# 1. ORIGINAL DATA - GICS Cross-tabulation
print("\nüìä ORIGINAL DATA - PAYER vs PAYEE GICS:")

# Count cross-tabulation
orig_gics_count_crosstab = pd.crosstab(
    orig_data['payer_GICS'],
    orig_data['payee_GICS'],
    margins=True,
    margins_name='Total'
)
print("\nüìä TRANSACTION COUNT CROSS-TABULATION (Original):")
display(orig_gics_count_crosstab)

# Amount cross-tabulation
orig_gics_amount_crosstab = pd.crosstab(
    orig_data['payer_GICS'],
    orig_data['payee_GICS'],
    values=orig_data['ed_amount'],
    aggfunc='sum',
    margins=True,
    margins_name='Total'
).round(0)
print("\nüí∞ TOTAL AMOUNT CROSS-TABULATION (Original):")
display(orig_gics_amount_crosstab)

print("\n‚úÖ CROSS-TABULATION ANALYSIS COMPLETED")
print("üìä Cross-tabulations generated:")
print("   ‚úì Industry Level: Count, Amount, Avg Amount per Transaction")
print("   ‚úì GICS Level: Count, Amount, Avg Amount per Transaction")
print("   ‚úì Both Original and Synthetic data tables")
